<div class="flex group">
    <div class="block-handle mr-2 opacity-0 group-hover:opacity-100">
        <i class="fas fa-grip-vertical text-gray-400 cursor-grab"></i>
    </div>
    <div class="flex-1">
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r">
            <div class="flex items-start">
                <div class="mr-3">
                    <span class="text-xl">{{ block.content.icon|default:"ðŸ’¡" }}</span>
                </div>
                <div contenteditable="{% if membership.can_edit %}true{% else %}false{% endif %}"
                     class="outline-none min-h-6 leading-relaxed flex-1"
                     data-placeholder="Write a callout..."
                     onblur="updateBlockContent(this, '{{ block.id }}')"
                     oninput="handleBlockInput(this)">{{ block.content.text|default:"" }}</div>
            </div>
        </div>
    </div>
    {% if membership.can_edit %}
        <div class="block-actions opacity-0 group-hover:opacity-100 ml-2">
            <button onclick="changeCalloutIcon('{{ block.id }}')" class="text-gray-400 hover:text-gray-600 p-1" title="Change icon">
                <i class="fas fa-smile text-xs"></i>
            </button>
            <button onclick="duplicateBlock('{{ block.id }}')" class="text-gray-400 hover:text-gray-600 p-1">
                <i class="fas fa-copy text-xs"></i>
            </button>
            <button onclick="deleteBlock('{{ block.id }}')" class="text-gray-400 hover:text-red-600 p-1">
                <i class="fas fa-trash text-xs"></i>
            </button>
        </div>
    {% endif %}
</div>

<script>
function changeCalloutIcon(blockId) {
    const newIcon = prompt('Enter new icon (emoji):', 'ðŸ’¡');
    if (newIcon) {
        const blockElement = document.querySelector(`[data-block-id="${blockId}"]`);
        const iconElement = blockElement.querySelector('span');
        iconElement.textContent = newIcon;
        
        // Update block content
        const textElement = blockElement.querySelector('[contenteditable]');
        updateBlockWithIcon(blockId, textElement.textContent, newIcon);
    }
}

function updateBlockWithIcon(blockId, text, icon) {
    fetch(`/api/blocks/${blockId}/`, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            content: {
                text: text,
                icon: icon
            }
        })
    });
}
</script>