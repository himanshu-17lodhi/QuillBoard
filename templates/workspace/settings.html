{% extends 'base.html' %}

{% block title %}Workspace Settings - QuillBoard{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="px-6 py-4 border-b">
            <h1 class="text-2xl font-bold">Workspace Settings</h1>
        </div>

        <div class="p-6">
            <form method="POST" id="workspace-settings-form">
                {% csrf_token %}
                
                <div class="space-y-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Workspace Name</label>
                        <input type="text" 
                               id="name" 
                               name="name" 
                               value="{{ workspace.name }}"
                               required
                               class="mt-1 block w-full form-input">
                    </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="description" 
                                name="description" 
                                rows="3"
                                class="mt-1 block w-full form-textarea">{{ workspace.description }}</textarea>
                    </div>

                    <div>
                        <label for="icon" class="block text-sm font-medium text-gray-700">Icon</label>
                        <input type="text" 
                               id="icon" 
                               name="icon" 
                               value="{{ workspace.icon }}"
                               class="mt-1 block w-full form-input">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Privacy</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input type="radio" 
                                       id="private" 
                                       name="is_private" 
                                       value="true"
                                       {% if workspace.is_private %}checked{% endif %}
                                       class="form-radio">
                                <label for="private" class="ml-3">
                                    <span class="block text-sm font-medium text-gray-700">Private</span>
                                    <span class="block text-sm text-gray-500">Only workspace members can access</span>
                                </label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" 
                                       id="public" 
                                       name="is_private" 
                                       value="false"
                                       {% if not workspace.is_private %}checked{% endif %}
                                       class="form-radio">
                                <label for="public" class="ml-3">
                                    <span class="block text-sm font-medium text-gray-700">Public</span>
                                    <span class="block text-sm text-gray-500">Anyone with the link can view</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button type="submit" class="btn-primary">
                        Save Changes
                    </button>
                </div>
            </form>

            <hr class="my-8">

            <!-- Members Section -->
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-medium">Members</h2>
                    <button id="invite-members" class="btn-secondary">
                        Invite Members
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    User
                                </th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Role
                                </th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Joined
                                </th>
                                <th class="px-6 py-3 bg-gray-50"></th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for member in members %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <img src="{{ member.user.avatar.url|default:'/static/img/default-avatar.png' }}" 
                                             alt="" 
                                             class="h-8 w-8 rounded-full">
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900">
                                                {{ member.user.get_full_name|default:member.user.email }}
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                {{ member.user.email }}
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <select name="role" 
                                            data-member-id="{{ member.id }}"
                                            class="form-select member-role-select"
                                            {% if member.user == workspace.created_by %}disabled{% endif %}>
                                        <option value="admin" {% if member.role == 'admin' %}selected{% endif %}>Admin</option>
                                        <option value="editor" {% if member.role == 'editor' %}selected{% endif %}>Editor</option>
                                        <option value="viewer" {% if member.role == 'viewer' %}selected{% endif %}>Viewer</option>
                                    </select>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    {{ member.joined_at|date:"M d, Y" }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    {% if member.user != workspace.created_by %}
                                    <button class="text-red-600 hover:text-red-900 remove-member"
                                            data-member-id="{{ member.id }}">
                                        Remove
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <hr class="my-8">

            <!-- Danger Zone -->
            <div>
                <h2 class="text-lg font-medium text-red-600">Danger Zone</h2>
                <div class="mt-4 space-y-4">
                    <div class="flex items-center justify-between py-4 border-t border-red-200">
                        <div>
                            <h3 class="text-sm font-medium text-gray-900">Delete Workspace</h3>
                            <p class="text-sm text-gray-500">
                                Once you delete a workspace, there is no going back. Please be certain.
                            </p>
                        </div>
                        <button id="delete-workspace" 
                                class="btn-danger"
                                data-workspace-id="{{ workspace.id }}">
                            Delete Workspace
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-workspace-modal" class="modal hidden">
    <div class="modal-content">
        <h3 class="text-lg font-bold text-red-600 mb-4">Delete Workspace</h3>
        <p class="text-gray-700 mb-4">
            Are you sure you want to delete this workspace? This action cannot be undone.
        </p>
        <div class="flex justify-end space-x-3">
            <button class="btn-secondary" data-close-modal>Cancel</button>
            <button id="confirm-delete" class="btn-danger">Delete</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/components/workspace-settings.js" type="module"></script>
{% endblock %}